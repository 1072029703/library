<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
 "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd">

<hibernate-mapping package="org.beangle.security.blueprint.model">
	
	<class name="UserCategoryBean" entity-name="org.beangle.security.blueprint.UserCategory">
		<cache usage="read-write" region="beangle.security"/>
		<id name="id" unsaved-value="null">
			<generator class="org.beangle.model.persist.hibernate.support.TableSeqGenerator"/>
		</id>
		<property name="name" length="50" unique="true"/>
	</class>
	
	<class name="UserBean" entity-name="org.beangle.security.blueprint.User">
		<id name="id" unsaved-value="null">
			<generator class="org.beangle.model.persist.hibernate.support.TableSeqGenerator"/>
		</id>
		<property name="name" not-null="true" unique="true" length="50"/>
		<property name="fullname" length="40" not-null="true"/>
		<property name="password" not-null="true" length="255"/>
		<property name="status" not-null="true"/>
		<property name="mail" length="100" not-null="true"/>
		<many-to-one name="creator"/>
		<many-to-one name="defaultCategory" not-null="true"/>
		<property name="createdAt" not-null="true"/>
		<property name="updatedAt" not-null="true"/>
		<property name="remark" length="500"/>
		
		<set name="categories">
			<key column="user_id"/>
			<many-to-many column="category_id" class="org.beangle.security.blueprint.UserCategory"/>
		</set>
		<set name="groups" inverse="true" cascade="all">
			<key column="user_id"/>
			<one-to-many class="org.beangle.security.blueprint.GroupMember"/>
		</set>
		<set name="restrictions" inverse="true" cascade="all,delete-orphan">
			<key column="holder_id"/>
			<one-to-many class="org.beangle.security.blueprint.restrict.UserRestriction"/>
		</set>
	</class>
	
	<class name="AdminUserBean" entity-name="org.beangle.security.blueprint.AdminUser">
		<cache usage="read-write" region="beangle.security"/>
		<id name="id" unsaved-value="null">
			<generator class="org.beangle.model.persist.hibernate.support.TableSeqGenerator"/>
		</id>
		<many-to-one name="user" not-null="true"/>
		<property name="createdAt" not-null="true"/>
		<property name="updatedAt" not-null="true"/>
	</class>
	
	<class name="GroupBean" entity-name="org.beangle.security.blueprint.Group">
		<cache usage="read-write" region="beangle.security"/>
		<id name="id" unsaved-value="null">
			<generator class="org.beangle.model.persist.hibernate.support.TableSeqGenerator"/>
		</id>
		<property name="name" length="50" unique="true" not-null="true"/>
		<property name="remark" length="500"/>
		
		<many-to-one name="owner" not-null="true"/>
		<many-to-one name="category" not-null="true"/>
		<many-to-one name="parent"/>
		<set name="children" inverse="true" cascade="all,delete-orphan">
			<key column="parent_id" not-null="true"/>
			<one-to-many class="org.beangle.security.blueprint.Group"/>
		</set>
		<property name="createdAt" not-null="true"/>
		<property name="updatedAt" not-null="true"/>
		<property name="enabled" not-null="true"/>
		
		<set name="members" inverse="true" cascade="all,delete-orphan">
			<key column="group_id"/>
			<one-to-many class="org.beangle.security.blueprint.GroupMember"/>
		</set>
		
		<set name="authorities" inverse="true" cascade="all,delete-orphan">
			<key column="group_id" not-null="true"/>
			<one-to-many class="org.beangle.security.blueprint.Authority"/>
		</set>
		
		<set name="restrictions" inverse="true" cascade="all,delete-orphan">
			<key column="holder_id"/>
			<one-to-many class="org.beangle.security.blueprint.restrict.GroupRestriction"/>
		</set>
	</class>
	
	<class name="GroupMemberBean" entity-name="org.beangle.security.blueprint.GroupMember">
		<id name="id" unsaved-value="null">
			<generator class="org.beangle.model.persist.hibernate.support.TableSeqGenerator"/>
		</id>
		<many-to-one name="user" not-null="true"/>
		<many-to-one name="group" not-null="true"/>
		<property name="createdAt" not-null="true"/>
		<property name="updatedAt" not-null="true"/>
		<property name="member" not-null="true"/>
		<property name="manager" not-null="true"/>
		<property name="granter" not-null="true"/>
	</class>
	
	<class name="ResourceBean" entity-name="org.beangle.security.blueprint.Resource">
		<cache usage="read-write" region="beangle.security"/>
		<id name="id" unsaved-value="null">
			<generator class="org.beangle.model.persist.hibernate.support.TableSeqGenerator"/>
		</id>
		<property name="name" length="50" unique="true"/>
		<property name="title" length="100" not-null="true"/>
		<property name="remark" length="100"/>
		<property name="enabled" not-null="true"/>
		<property name="scope" not-null="true"/>
		<set name="entities">
			<key column="resource_id" not-null="true"/>
			<many-to-many column="entity_id" class="org.beangle.security.blueprint.restrict.RestrictEntity"/>
		</set>
		<set name="categories">
			<key column="resource_id" not-null="true"/>
			<many-to-many column="category_id" class="org.beangle.security.blueprint.UserCategory"/>
		</set>
	</class>
	
	<class name="AuthorityBean" entity-name="org.beangle.security.blueprint.Authority">
		<id name="id" unsaved-value="null">
			<generator class="org.beangle.model.persist.hibernate.support.TableSeqGenerator"/>
		</id>
		<many-to-one name="group"/>
		<many-to-one name="resource"/>
		
		<set name="restrictions" cascade="all,delete-orphan">
			<key column="holder_id"/>
			<one-to-many class="org.beangle.security.blueprint.restrict.AuthorityRestriction"/>
		</set>
	</class>
	
	<class name="MenuBean" entity-name="org.beangle.security.blueprint.Menu">
		<cache usage="read-write" region="beangle.security"/>
		<id name="id" unsaved-value="null">
			<generator class="org.beangle.model.persist.hibernate.support.TableSeqGenerator"/>
		</id>
		<many-to-one name="profile" not-null="true"/>
		<many-to-one name="parent"/>
		<property name="code" length="32" not-null="true"/>
		<property name="title" length="100" not-null="true"/>
		<property name="engTitle" length="100" not-null="true"/>
		<property name="remark" length="100"/>
		<property name="entry"/>
		<property name="enabled" not-null="true"/>
		<bag name="children">
			<cache usage="read-write" region="beangle.security"/>
			<key column="parent_id"/>
			<one-to-many class="org.beangle.security.blueprint.Menu"/>
		</bag>
		<set name="resources" batch-size="16">
			<cache usage="read-write" region="beangle.security"/>
			<key column="menu_id"/>
			<many-to-many class="org.beangle.security.blueprint.Resource" column="resource_id"/>
		</set>
	</class>
	<!--
	<class
	name="MenuAuthorityBean" entity-name="org.beangle.security.blueprint.MenuAuthority">
	<id name="id" unsaved-value="null">
	<generator class="org.beangle.model.persist.hibernate.support.TableSeqGenerator"/>
	</id>
	<many-to-one name="group"/>
	<many-to-one name="menu"/>
	</class>
	-->
	<class name="MenuProfileBean" entity-name="org.beangle.security.blueprint.MenuProfile">
		<cache usage="read-write" region="beangle.security"/>
		<id name="id" unsaved-value="null">
			<generator class="org.beangle.model.persist.hibernate.support.TableSeqGenerator"/>
		</id>
		<property name="name" length="50" unique="true"/>
		<bag name="menus" cascade="all">
			<key column="profile_id"/>
			<one-to-many class="org.beangle.security.blueprint.Menu"/>
		</bag>
		<many-to-one name="category" not-null="true"/>
		<property name="enabled" not-null="true"/>
	</class>
	<query name="getAuthorityByResource">
		<![CDATA[ from Authority as ra  where	(ra.group = :group and ra.resource = :resource) ]]>
	</query>
	<query name="getAuthorities">
		<![CDATA[
       select distinct a from  Group as r join r.authorities as a join a.resource as m  where r.id = :groupId ]]>
	</query>
</hibernate-mapping>
