(function(bg,undefined){function NamedFunction(e,t,n){this.name=e,this.func=t,this.objectCount=null==n?"ge0":n}function ToolBar(divId,title,imageName){function genIconElement(e,t){var n="action-default";if(null!=t){if(t.indexOf(".")>-1)return"/"!=t.charAt(0)&&(t=imagePath+t),'<img class="toolbar-img" src="'+t+'"/>';n=t}return null==t&&null!=e&&("object"==typeof e&&(e=e.name),"string"==typeof e&&(0==e.indexOf("add")||0==e.indexOf("batchAdd")||0==e.indexOf("new")?n="action-new":0==e.indexOf("remove")||0==e.indexOf("delete")?n="action-edit-delete":0==e.indexOf("update")||0==e.indexOf("edit")||0==e.indexOf("batchEdit")?n="action-update":0==e.indexOf("export")?n="action-excel":0==e.indexOf("copy")?n="action-edit-copy":0==e.indexOf("print")?n="action-print":0==e.indexOf("refresh")?n="action-refresh":0==e.indexOf("close")?n="action-close":0==e.indexOf("save")?n="action-save":0==e.indexOf("download")&&(n="action-download"))),'<span class="toolbar-icon '+n+'" ></span>'}function setAction(item,action){return null==action?(bg.alert("action should not be null"),undefined):"function"==typeof action?(item.onclick=action,undefined):("string"==typeof action&&(-1!=action.indexOf("(")?item.onclick=function(){eval(action)}:-1!=action.indexOf(".action")?item.onclick=function(){Go(action)}:bg.alert("unsuported action description:"+action)),"object"==typeof action?(item.onclick=action.func,undefined):undefined)}function hiddenMenu(e){for(var t=bg.event.getTarget(e);t&&"div"!=t.tagName.toLowerCase();)t=t.parentNode;var n=t.lastElementChild||t.lastChild;if(null==n||"table"!=n.tagName.toLowerCase())return alert("menu is null then return and target is "+t),undefined;if(""!=n.style.visibility&&"hidden"!=n.style.visibility){for(var i=0;n.rows.length>i;i++)if("toolbar-menuitem-transfer"==n.rows[i].cells[0].className)return;n.style.visibility="hidden"}}function displayMenu(e){for(var t=bg.event.getTarget(e);t&&"div"!=t.tagName.toLowerCase();)t=t.parentNode;var n=t.lastElementChild||t.lastChild;return null==n?(alert("menu is null then return and target is "+t),undefined):(""!=n.style.visibility&&"hidden"!=n.style.visibility?(n.style.visibility="hidden",t.className="toolbar-item-transfer"):(n.style.visibility="visible",t.className="toolbar-item-selected"),undefined)}function Menu(e,t){var n=document.createElement("table");n.className="toolbar-menu",n.id=e+"Table";var i=document.createElement("tbody");n.appendChild(i),jQuery("#"+e).find("span").length>0&&(n.onclick=function(e){displayMenu(e)}),t.appendChild(n),this.table=n,this.addItem=function(e,t,n,i){var a=document.createElement("td");a.innerHTML=genIconElement(t,n)+e,a.onmouseout=MouseOutMenuItem,a.onmouseover=MouseOverMenuItem,a.title=i||e,setAction(a,t),a.className="toolbar-menuitem",a.width="100%";var r=document.createElement("tr");r.appendChild(a),0==this.table.tBodies.length&&this.table.appendChild(document.createElement("tbody")),this.table.tBodies[0].appendChild(r)}}function MouseOutMenuItem(e){for(var t=bg.event.getTarget(e);t&&"td"!=t.tagName.toLowerCase();)t=t.parentNode;t&&(t.className="toolbar-menuitem")}function MouseOverMenuItem(e){for(var t=bg.event.getTarget(e);t&&"td"!=t.tagName.toLowerCase();)t=t.parentNode;t&&(t.className="toolbar-menuitem-transfer")}function MouseOverItem(e){for(var t=bg.event.getTarget(e);t&&"div"!=t.tagName.toLowerCase();)t=t.parentNode;t&&jQuery(t).removeClass("toolbar-item").addClass("toolbar-item-transfer")}function MouseOutItem(e){for(var t=bg.event.getTarget(e);t&&"div"!=t.tagName.toLowerCase();)t=t.parentNode;t&&jQuery(t).removeClass("toolbar-item-transfer").addClass("toolbar-item")}if(this.itemCount=0,this.bar=document.getElementById(divId),null!=this.bar){this.id=divId,this.separator="&nbsp;",this.bar.className="toolbar notprint";var imageRoot=self.location.pathname.substring(0,self.location.pathname.substring(1).indexOf("/")+1)+"/static/themes/"+bg.uitheme+"/icons/",imagePath=imageRoot+"16x16/actions/";this.setTitle=function(e,t){e&&(null==t&&(t="action-info"),this.title_div.innerHTML=genIconElement(null,t)+"<strong>"+e+"</strong>")},this.setSeparator=function(e){this.separator=e},this.init=function(e,t){var n,i,a=document.createElement("div");a.className="toolbar-title",this.bar.appendChild(a),this.title_div=a,this.setTitle(e,t),i=document.createElement("div"),i.className="toolbar-items",i.id=this.id+"_items",this.items_div=i,this.bar.appendChild(i),n=document.createElement("div"),n.className="toolbar-msg",n.style.display="none",n.id=this.id+"_msg",this.bar.appendChild(n)},this.init(title,imageName),this.addHr=function(){hrdiv=this.appendDiv(null,"toolbar-line"),hrdiv.innerHTML='<img height="1" width="100%" align="top" src="'+imagePath+'keyline.png" />'},this.addBack=function(e){null==e?this.addItem("返回",function(){history.back(-1)},"action-backward"):this.addItem(e,function(){history.back(-1)},"action-backward")},this.addHelp=function(e){this.addItem("帮助",function(){null==e?bg.alert("施工中.."):window.open("help.action?helpId="+e)},"action-help-contents")},this.addPrint=function(e){null==e?this.addItem("打印","print()"):this.addItem(e,"print()")},this.addClose=function(e){(""==e||null==e)&&(e="关闭"),this.addItem(e,"window.close()","action-close")},this.addItem=function(e,t,n,i,a){this.addSeparatorAsNeed();var r=document.createElement("div");return r.innerHTML=genIconElement(t,n)+e,r.onmouseout=MouseOutItem,r.onmouseover=MouseOverItem,setAction(r,t),a||"object"==typeof t&&(a=t.objectCount),a||(a="ge0"),r.className="toolbar-item toolbar-item-"+a+("ge0"!=a?" toolbar-item-disabled":""),r.title=null==i?e:i,this.items_div.appendChild(r),this.itemCount++,r},this.addDiv=function(e){var t=document.createElement("div");return e&&(t.className=e),this.items_div.appendChild(t),t},this.appendDiv=function(e,t){var n=document.createElement("div");return e&&n.setAttribute("id",e),t&&(n.className=t),document.getElementById(this.id).appendChild(n),n},this.addSeparator=function(){this.separator&&(this.addDiv("toolbar-separator").innerHTML=this.separator)},this.addSeparatorAsNeed=function(){0!=this.itemCount&&this.addSeparator()},this.addBackOrClose=function(e,t){parent.location==self.location&&(1>=window.history.length||null==window.history.length)?this.addClose(null==t?"关闭":t):this.addBack(null==e?"后退":e)},this.addBlankItem=function(){this.addDiv("toolbar-group-separator").innerHTML="&nbsp;",this.itemCount++},this.setMessage=function(e){e!==undefined&&(document.getElementById(this.id+"_msg").innerHTML=e)},this.addMenu=function(e,t,n,i){this.addSeparatorAsNeed();var a=document.createElement("div");a.className="toolbar-item";var r=this.id+this.itemCount+"_menu";if(a.id=r,a.tabIndex=0,a.title=i||e,a.onmouseout=MouseOutItem,a.onmouseover=MouseOverItem,this.items_div.appendChild(a),null==t)a.innerHTML=genIconElement(null,n)+e+"&nbsp;"+genIconElement(null,"action-downarrow"),a.onclick=function(e){displayMenu(e)};else{var o=document.createElement("span");o.innerHTML=genIconElement(t,n)+e,setAction(o,t);var s=document.createElement("span");s.innerHTML=genIconElement(t,"action-downarrow"),s.onclick=function(e){displayMenu(e)},a.appendChild(o),a.appendChild(s)}a.onblur=function(e){hiddenMenu(e)};var d=new Menu(r,a);return this.itemCount++,d}}}function EntityAction(e,t){function n(e,t){var n=e.lastIndexOf("!"),i=e.lastIndexOf("."),a=e,r="";return-1==n&&(n=i),-1!=n&&(a=e.substring(0,n)),-1!=i&&(r=e.substring(i)),a+"!"+t+r}this.entity=e,this.page=t,this.formid="form_"+bg.randomInt();var i=this;if(this.getForm=function(){return this.page.getForm()},this.addParam=function(e,t){bg.form.addInput(this.getForm(),e,t)},null!=this.page.target&&""!=this.page.target){var a=this.getForm();null!=a&&(a.target=this.page.target)}this.beforeSubmmitId=function(t){var i=bg.input.getCheckBoxValues(e+".id");if(null==i||""==i)return bg.alert("你没有选择要操作的记录！"),!1;var a=this.getForm();return a.action=n(this.page.actionurl,t),this.page.paramstr&&(bg.form.addHiddens(a,this.page.paramstr),bg.form.addParamsInput(a,this.page.paramstr)),!0},this.submitIdAction=function(e,t,n,i){if(this.beforeSubmmitId(e)){if(null!=n&&""!=n&&!confirm(n))return;bg.form.submitId(this.getForm(),this.entity+".id",t,null,null,i)}},this.remove=function(e){return e=e||"确认删除?",new NamedFunction("remove",function(){i.submitIdAction("remove",!0,e)},bg.ui.grid.enableDynaBar?"ge1":"ge0")},this.add=function(){return new NamedFunction("add",function(){var e=i.getForm();""!=i.page.paramstr&&bg.form.addHiddens(e,i.page.paramstr),bg.form.addInput(e,i.entity+".id",""),""!=i.page.paramstr&&bg.form.addParamsInput(e,i.page.paramstr),bg.form.submit(e,n(i.page.actionurl,"edit"))})},this.info=function(){return new NamedFunction("info",function(){i.submitIdAction("info",!1)},bg.ui.grid.enableDynaBar?"e1":"ge0")},this.edit=function(){return new NamedFunction("edit",function(){i.submitIdAction("edit",!1)},bg.ui.grid.enableDynaBar?"e1":"ge0")},this.single=function(e,t,n){return new NamedFunction(e,function(){var a=i.getForm();null!=n&&bg.form.addHiddens(a,n),i.submitIdAction(e,!1,t)},bg.ui.grid.enableDynaBar?"e1":"ge0")},this.multi=function(e,t,n,a){return new NamedFunction(e,function(){try{var r=i.getForm();null!=n&&bg.form.addHiddens(r,n),i.submitIdAction(e,!0,t,a)}catch(o){bg.alert(o)}},bg.ui.grid.enableDynaBar?"ge1":"ge0")},this.method=function(e,t,a,r){return new NamedFunction(e,function(){var o=i.getForm();(null==t||""==t||confirm(t))&&(null!=a&&bg.form.addHiddens(o,a),""!=i.page.paramstr&&(bg.form.addHiddens(o,i.page.paramstr),bg.form.addParamsInput(o,i.page.paramstr)),bg.form.submit(o,n(i.page.actionurl,e),null,null,r))})},this.exportData=function(e,t,n){return t=t||"xls",e=e||"",n=n||"",0!=n.indexOf("&")&&(n="&"+n),n="&format="+t+"&props="+e+n,i.method("export",null,n,!1)}}bg.alert=function(e){alert(e)},bg.uitheme="default",bg.extend({"ui.toolbar":function(e,t,n){return new ToolBar(e,t,n)}}),bg.extend({"ui.gridbar":function(e,t){function n(e,t,n,i,a){for(var r=[],o=0;a.length>o;o++)r[o]=a[o].addMenu(e,t,n,i);this.addItem=function(e,t,n,i){for(var a=0;r.length>a;a++)r[a].addItem(e,t,n,i)}}this.divIds=e,this.pageId=null,this.title=t,this.toolbars=[];for(var i=0;e.length>i;i++)this.toolbars[i]=bg.ui.toolbar(e[i],t),this.toolbars[i].setSeparator(""),document.getElementById(e[i]).className="gridbar",document.getElementById(e[i]+"_items").className="gridbar-items";this.pageId=function(e){return this.pageId=e,this},this.addItem=function(e,t,n,i){for(var a=0;this.toolbars.length>a;a++)this.toolbars[a].addItem(e,t,n,i)},this.addBack=function(e){for(var t=0;this.toolbars.length>t;t++)this.toolbars[t].addBack(e)},this.addBackOrClose=function(){for(var e=0;this.toolbars.length>e;e++)this.toolbars[e].addBackOrClose()},this.addBlankItem=function(e,t,n,i){for(var a=0;this.toolbars.length>a;a++)this.toolbars[a].addBlankItem(e,t,n,i)},this.addPage=function(t,n,i){this.myPage=t;for(var a=0;this.toolbars.length>a;a++)pageDiv=this.toolbars[a].appendDiv(e[a]+"_page","girdbar-pgbar"),bg.ui.pagebar(t,pageDiv,n,i);return this},this.addEntityAction=function(e,t){return new bg.entityaction(e,t)},this.addPrint=function(e){for(var t=0;this.toolbars.length>t;t++)this.toolbars[t].addPrint(e)},this.addMenu=function(e,t,i,a){return new n(e,t,i,a,this.toolbars)}}}),bg.extend({"ui.pagebar":function(e,t,n,i){if(0!=e.total){n?0==n.length&&(n=[e.pageSize]):n=[10,20,30,50,70,100,200,500,1e3],i||(i={first:"« First",previous:"‹ Previous",next:"Next ›",last:"Last »",no:"No:",size:"Size:",change:"Click me to change page size",pagesize:"Page Size"});var a=e.maxPageNo;addAnchor=function(n,i){var a=document.createElement("a");a.setAttribute("href","javascript:void(0)"),a.innerHTML=n,a.style.padding="0px 2px 0px 2px",t.appendChild(a),jQuery(a).click(function(){e.goPage(i)})},e.pageNo>1&&(addAnchor(i.first,1),addAnchor(i.previous,e.pageNo-1));var r=document.createElement("span");r.innerHTML="<strong>"+e.startNo+"</strong> - <strong>"+e.endNo+"</strong> of <strong>"+e.total+"</strong>",r.style.padding="0px 2px 0px 2px",t.appendChild(r);var o=jQuery(r);o.attr("title",i.change),o.mouseover(function(){this.className="pgbar-label"}),o.mouseout(function(){this.className=""}),o.click(function(){this.parentNode.style.marginTop="0px",this.nextSibling.style.display="",this.style.display="none"});var s=document.createElement("span");if(s.style.display="none",n&&n.length>0){var d=document.createElement("select");d.id=t.id+"_select",s.appendChild(d),d.className="pgbar-selbox",d.title=i.pagesize||"Page Size";for(var l=0,u=0;n.length>u;u++)n[u]==e.pageSize&&(l=u),d.options.add(new Option(i.size+n[u],n[u]));d.selectedIndex=l}var c=document.createElement("input");c.className="pgbar-input",s.appendChild(c);var m=document.createElement("label");s.appendChild(m),jQuery(m).attr("for",t.id+"_input").text("/"+a+" ").toggleClass("pgbar-input-label");var g=jQuery(c);g.attr("value",e.pageNo),g.attr("id",t.id+"_input"),g.attr("title",e.startNo+" - "+e.endNo+" of "+e.total),g.focus(function(){this.value=""}),g.blur(function(){this.value||(this.value=e.pageNo)});var h=document.createElement("input");h.setAttribute("type","button"),h.setAttribute("name","gogo"),h.value="Go",h.className="pgbar-go",s.appendChild(h);var f=function(){var n=document.getElementById(t.id+"_input").value,i=n.indexOf("/"+e.maxPageNo);-1!=i&&(n=n.substring(0,i)),e.goPage(n,document.getElementById(t.id+"_select").value)};jQuery(h).click(function(){f()}),t.appendChild(s),jQuery(s).keypress(function(e){return e||(e=window.event),e&&e.keyCode&&13==e.keyCode?(f(),!1):undefined}),e.pageNo<e.maxPageNo&&(addAnchor(i.next,e.pageNo+1),addAnchor(i.last,e.maxPageNo))}}}),bg.extend({"ui.grid":{enableSingleRowSelect:!1,enableDynaBar:!1,enableSelectTip:!0,overSortTableHeader:function(){this.style.color="white",this.style.backgroundColor="green"},outSortTableHeader:function(){this.style.borderColor="",this.style.color="",this.style.backgroundColor=""},mouseOverGrid:function(){if(this.className!==undefined){var e=this.className;selectIndex=e.indexOf("griddata-selected"),-1==selectIndex&&(overIndex=e.indexOf("griddata-over"),this.className=-1==overIndex?e+" "+"griddata-over":e.substring(0,overIndex))}},setGridMessage:function(e,t){var n=document.getElementById(e+"_bar1_msg"),i=document.getElementById(e+"_bar2_msg");n&&(n.style.display=t?"":"none",n.innerHTML=t?t:""),i&&(i.style.display=t?"":"none",i.innerHTML=t?t:"")},toggleAll:function(e){for(var t=bg.event.getTarget(e),n=t;null!=n.tagName&&"table"!=n.tagName.toLowerCase()&&(n=n.parentNode,null!=n););if(t.parentNode,null!=n){var i=0;jQuery("#"+n.id+" .gridselect").each(function(){var e=jQuery(this).find("input");0!=e.length&&(t.checked?(e.attr("checked","checked"),jQuery(this).parent("tr").addClass("griddata-selected"),i++):e.is(":checked")&&(e.removeAttr("checked"),jQuery(this).parent("tr").removeClass("griddata-selected")))}),bg.ui.grid.notifyGridbar(n.id,i)}},notifyGridbar:function(e,t){var n=function(){t>=2?jQuery(this).hasClass("toolbar-item-e1")?jQuery(this).addClass("toolbar-item-disabled"):jQuery(this).removeClass("toolbar-item-disabled"):1==t?jQuery(this).hasClass("toolbar-item-ge2")?jQuery(this).addClass("toolbar-item-disabled"):jQuery(this).removeClass("toolbar-item-disabled"):jQuery(this).hasClass("toolbar-item-ge0")?jQuery(this).removeClass("toolbar-item-disabled"):jQuery(this).addClass("toolbar-item-disabled")};bg.ui.grid.enableDynaBar&&(jQuery("#"+e+"_bar1_items .toolbar-item").each(n),jQuery("#"+e+"_bar2_items .toolbar-item").each(n)),bg.ui.grid.enableSelectTip&&(t>1?bg.ui.grid.setGridMessage(e,"已选择 <b>"+t+"</b> 条"):bg.ui.grid.setGridMessage(e,""))},toggleRow:function(e){for(var t=bg.event.getTarget(e),n=t;null!=n.tagName&&"table"!=n.tagName.toLowerCase()&&(n=n.parentNode,null!=n););var i=!0,a=null,r=!1;if(null!=t&&"td"==t.tagName.toLowerCase()){for(a=t.parentNode.firstChild;null==a.tagName||"td"!=a.tagName.toLowerCase();)a=a.nextSibling;for(r=t==a,t=a.firstChild;t.tagName===undefined||"input"!=t.tagName.toLowerCase();)if(t=t.nextSibling,null==t)return;t.checked=!t.checked}else"checkbox"==t.type||"radio"==t.type?(a=t.parentNode,r=!0):i=!1;if(null!=t&&null!=a&&null!=n&&i){var o=a.parentNode;if(o.className!==undefined){t.checked?jQuery(o).removeClass("griddata-over").addClass("griddata-selected"):jQuery(o).removeClass("griddata-selected").addClass("griddata-over");var s=0;if("radio"==t.type)t.checked&&(s=1);else{var d=!bg.ui.grid.enableSingleRowSelect||r||e.ctrlKey;jQuery("#"+n.id+" .gridselect").each(function(){jQuery(this).find("input").is(":checked")&&(a==this||d?s++:(jQuery(this).find("input").removeAttr("checked"),jQuery(this).parent("tr").removeClass("griddata-selected")))}),d||jQuery("#"+n.id+" .gridselect-top").each(function(){jQuery(this).find("input").removeAttr("checked")})}bg.ui.grid.notifyGridbar(n.id,s),"function"==typeof t.onchange&&t.onchange()}}},sort:function(e,t){if(null==e)return bg.alert("无法找到元素对应的排序表格！"),undefined;var n=null;n="gridhead-sortable"==t.className?t.asc!==undefined?t.asc:t.id+" asc":"gridhead-asc"==t.className?t.desc!==undefined?t.desc:t.id.replace(/\,/g," desc,")+" desc":"",e.goPage(1,null,n)},init:function(e,t){var n,i,a,r,o,s,d,l,u,c,m,g=document.getElementById(e),h=g.tHead;if(h&&0!=h.rows.length){for(i=t.orderby,a=function(){bg.ui.grid.sort(t,this)},o=0;h.rows.length>o;o++)for(s=h.rows[o],r=0;s.cells.length>r;r++)if(l=s.cells[r],"gridhead-sortable"==l.className&&null!=l.id){if(l.onclick=a,l.onmouseover=bg.ui.grid.overSortTableHeader,l.onmouseout=bg.ui.grid.outSortTableHeader,l.title="点击按 ["+l.innerHTML+"] 排序",u=l.id.replace(/\,/g," desc,")+" desc",l.desc!==undefined&&(u=l.desc),-1!=i.indexOf(u)){l.className="gridhead-desc",l.innerHTML=l.innerHTML+'<span class="gridhead-icon action-sort-desc"></span>';continue}if(c=l.id+" asc",l.asc!==undefined&&(c=l.asc),i==c){l.className="gridhead-asc",l.innerHTML=l.innerHTML+'<span class="gridhead-icon action-sort-asc"></span>';continue}}if(n=document.getElementById(e+"_data"))for(o=0;n.rows.length>o;o++)d=n.rows[o],m=d.className,m=m?" "+m:"",d.className=1==o%2?"griddata-odd"+m:"griddata-even"+m,d.onclick=bg.ui.grid.toggleRow,d.onmouseover=bg.ui.grid.mouseOverGrid,d.onmouseout=bg.ui.grid.mouseOverGrid}},fillEmpty:function(e,t,n,i){var a,r,o=document.getElementById(e),s=t-n;s>7&&(s=7),a=16*s,0==n&&(r=document.createElement("div"),r.innerHTML=i||"No result matched your search.",r.style.paddingTop=a/2-16+"px",o.appendChild(r)),o.style.height=a+"px"}}}),bg.extend({entityaction:EntityAction}),bg.extend({"ui.module":{moduleClick:function(e){var t=document.getElementById(e);t.className="module collapsed"==t.className?"module expanded":"module collapsed"}}}),bg.extend({"ui.load":function(e,t){var n=bg.getContextPath();"validity"==e?(jQuery.struts2_jquery.requireCss("/static/themes/"+bg.uitheme+"/jquery.validity.css",n),jQuery.struts2_jquery.require("/static/scripts/jquery/jquery-validity-1.1.1.js",null,n),jQuery.struts2_jquery.require("/static/scripts/i18n/zh_CN/jquery.validity.js",t,n)):"tabletree"==e?(jQuery.struts2_jquery.requireCss("/static/themes/"+bg.uitheme+"/beangle-ui-tabletree.css",n),jQuery.struts2_jquery.require("/static/scripts/beangle/beangle-ui-tabletree-3.0.0.js",t,n)):"colorbox"==e?(jQuery.struts2_jquery.requireCss("/static/themes/"+bg.uitheme+"/colorbox.css",n),jQuery.struts2_jquery.require("/static/scripts/jquery/jquery-colorbox-1.3.17.1.min.js",t,n)):"jquery.pstrength"==e&&(jQuery.struts2_jquery.requireCss("/static/themes/"+bg.uitheme+"/jquery-pstrength.css",n),jQuery.struts2_jquery.require("/static/scripts/jquery/jquery-pstrength-2.1.js",t,n),jQuery.struts2_jquery.require("/static/scripts/i18n/zh_CN/jquery-pstrength.js",t,n))}})})(beangle);